(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 11.1' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     16592,        421]
NotebookOptionsPosition[     16287,        407]
NotebookOutlinePosition[     16629,        422]
CellTagsIndexPosition[     16586,        419]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"StructureComputation", "[", 
    RowBox[{"F_", ",", "PC1_", ",", "PC2_"}], "]"}], ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "T", ",", "TPrime", ",", "StructureF", " ", ",", "R", ",", " ", 
       "RPrime", ",", "RotatedF", ",", " ", "f", " ", ",", " ", "fPrime", ",",
        " ", "a", ",", "b", ",", "c", ",", "d"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Print", "[", 
       RowBox[{"\"\<PC1 = \>\"", ",", " ", 
        RowBox[{"MatrixForm", "[", "PC1", "]"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"\"\<PC2 = \>\"", ",", " ", 
        RowBox[{"MatrixForm", "[", "PC2", "]"}]}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"\"\<F = \>\"", ",", " ", "F"}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "definition", " ", "of", " ", "Transformationmatrix", " ", "that", " ",
         "transforms", " ", "measured", " ", "correspondence", " ", "points", 
        RowBox[{"(", 
         RowBox[{"example", " ", "with", " ", "point", " ", "a"}], ")"}], " ",
         "to", " ", "origin"}], "*)"}], "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"T", "=", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", " ", ",", "0", ",", 
           RowBox[{"-", 
            RowBox[{"PC1", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "1"}], "]"}], "]"}]}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", "1", ",", 
           RowBox[{"-", 
            RowBox[{"PC1", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "2"}], "]"}], "]"}]}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], "}"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"TPrime", "=", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", " ", ",", "0", ",", 
           RowBox[{"-", 
            RowBox[{"PC2", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "1"}], "]"}], "]"}]}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", "1", ",", 
           RowBox[{"-", 
            RowBox[{"PC2", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "2"}], "]"}], "]"}]}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], "}"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"\"\<T = \>\"", ",", " ", 
        RowBox[{"MatrixForm", "[", "T", "]"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"\"\<TPrime = \>\"", ",", " ", 
        RowBox[{"MatrixForm", "[", "TPrime", "]"}]}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"Replace", " ", "F", " ", "with", "  ", 
         RowBox[{
          RowBox[{"Transpose", "[", 
           RowBox[{"Inverse", "[", "TPrime", "]"}], "]"}], ".", "F", ".", 
          RowBox[{"Inverse", "[", "T", "]"}]}]}], ",", " ", 
        RowBox[{
        "this", " ", "F", " ", "now", " ", "corresponce", " ", "to", " ", 
         "translated", " ", "coordinates"}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"StructureF", " ", "=", " ", 
       RowBox[{
        RowBox[{"Transpose", "[", 
         RowBox[{"Inverse", "[", "TPrime", "]"}], "]"}], ".", "F", ".", 
        RowBox[{"Inverse", "[", "T", "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"\"\<StructureF = \>\"", ",", " ", 
        RowBox[{"MatrixForm", "[", "StructureF", "]"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"epipole", "=", 
       RowBox[{"Flatten", "[", 
        RowBox[{"NullSpace", "[", "StructureF", "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"epipolePrime", " ", "=", " ", 
       RowBox[{"Flatten", "[", 
        RowBox[{"NullSpace", "[", 
         RowBox[{"Transpose", "[", "StructureF", "]"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"\"\<epipole = \>\"", ",", " ", 
        RowBox[{"MatrixForm", "[", "epipole", "]"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"\"\<epipolePrime = \>\"", ",", " ", 
        RowBox[{"MatrixForm", "[", "epipolePrime", "]"}]}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
         RowBox[{"Scale", " ", "epipole", " ", "so", " ", "that", " ", 
          RowBox[{
           RowBox[{"epipole", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "^", "2"}]}], "+", 
         RowBox[{
          RowBox[{"epipole", "[", 
           RowBox[{"[", "2", "]"}], "]"}], "^", "2"}]}], " ", "=", " ", 
        RowBox[{"1", " ", "\[Rule]", " ", 
         RowBox[{
         "in", " ", "this", " ", "case", " ", "no", " ", "scaling", " ", "is",
           " ", "needet"}]}]}], "*)"}], "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"Teste", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"epipole", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "^", "2"}], "+", 
        RowBox[{
         RowBox[{"epipole", "[", 
          RowBox[{"[", "2", "]"}], "]"}], "^", "2"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"TestePrime", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"epipolePrime", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "^", "2"}], "+", 
        RowBox[{
         RowBox[{"epipolePrime", "[", 
          RowBox[{"[", "2", "]"}], "]"}], "^", "2"}]}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{
       "\"\<epipole[[1]]^2+epipole[[2]]^2 = \>\"", ",", " ", "Teste"}], "]"}],
       ";", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{
       "\"\<epipolePrime[[1]]^2+epipolePrime[[2]]^2 = \>\"", ",", " ", 
        "TestePrime"}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "Form", " ", "matrices", " ", "and", " ", "check", " ", "if", " ", 
        "those", " ", "are", " ", "Rotation", " ", "matrices"}], "*)"}], 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"R", " ", "=", " ", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"epipole", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", 
           RowBox[{"epipole", "[", 
            RowBox[{"[", "2", "]"}], "]"}], ",", "0"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"-", 
            RowBox[{"epipole", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], ",", 
           RowBox[{"epipole", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", "0"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], "}"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"RPrime", " ", "=", " ", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"epipolePrime", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", 
           RowBox[{"epipolePrime", "[", 
            RowBox[{"[", "2", "]"}], "]"}], ",", "0"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"-", 
            RowBox[{"epipolePrime", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], ",", 
           RowBox[{"epipolePrime", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", "0"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], "}"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"\"\<R = \>\"", ",", " ", "R"}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"\"\<RPrime = \>\"", ",", " ", "RPrime"}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"RTest", "=", " ", 
       RowBox[{
        RowBox[{"Transpose", "[", "R", "]"}], ".", "R"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"RPrimeTest", "=", " ", 
       RowBox[{
        RowBox[{"Transpose", "[", "RPrime", "]"}], ".", "RPrime"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"\"\<R is Rotation = \>\"", ",", "RTest"}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"\"\<RPrime is Rotation = \>\"", ",", "RPrimeTest"}], "]"}], 
      ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"Rep", "=", " ", 
       RowBox[{"R", ".", "epipole"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"RePrime", "=", 
       RowBox[{"RPrime", ".", "epipolePrime"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"\"\<R and epipole should be (1,0,e_3) = \>\"", ",", "Rep"}], 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{
       "\"\<RPrime and epipolePrime should be (1,0,e_3') = \>\"", ",", 
        "RePrime"}], "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Replace", " ", "F", " ", "with", " ", 
        RowBox[{"RPrime", ".", "StructureF", ".", 
         RowBox[{"R", "^", "T"}]}]}], "*)"}], "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"RotatedF", "=", " ", 
       RowBox[{"RPrime", ".", "StructureF", ".", 
        RowBox[{"Transpose", "[", "R", "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"\"\<RotatedF = \>\"", ",", " ", 
        RowBox[{"MatrixForm", "[", "RotatedF", "]"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"Set", " ", "variables", " ", "f"}], ",", " ", "fPrime", ",", 
        " ", "a", ",", " ", "b", ",", " ", "c", ",", " ", 
        RowBox[{"d", " ", "for", " ", "further", " ", "computations"}]}], 
       "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"f", "=", " ", 
       RowBox[{"epipole", "[", 
        RowBox[{"[", "3", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"fPrime", "=", 
       RowBox[{"epipolePrime", "[", 
        RowBox[{"[", "3", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"a", "=", " ", 
       RowBox[{"RotatedF", "[", 
        RowBox[{"[", 
         RowBox[{"2", ",", "2"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"b", "=", 
       RowBox[{"RotatedF", "[", 
        RowBox[{"[", 
         RowBox[{"2", ",", "3"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"c", "=", 
       RowBox[{"RotatedF", "[", 
        RowBox[{"[", 
         RowBox[{"3", ",", "2"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"d", "=", 
       RowBox[{"RotatedF", "[", 
        RowBox[{"[", 
         RowBox[{"3", ",", "3"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Form", " ", "the", " ", "polynomial", " ", "g", 
        RowBox[{"(", "t", ")"}]}], "*)"}], "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"roots", " ", "=", " ", 
       RowBox[{"Solve", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"t", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"a", "*", "t"}], "+", "b"}], ")"}], "^", "2"}], "+", 
               RowBox[{
                RowBox[{"fPrime", "^", "2"}], 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"c", "*", "t"}], "+", "d"}], ")"}], "^", "2"}]}]}],
               ")"}], "^", "2"}]}], "-", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"a", "*", "d"}], "-", 
              RowBox[{"b", "*", "c"}]}], ")"}], "*", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"1", "+", 
               RowBox[{
                RowBox[{"f", "^", "2"}], "*", 
                RowBox[{"t", "^", "2"}]}]}], ")"}], "^", "2"}], "*", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"a", "*", "t"}], "+", "b"}], ")"}], "*", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"c", "*", "t"}], "+", "d"}], ")"}]}]}], "\[Equal]", 
          "0"}], ",", "t"}], "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"\"\<roots = \>\"", ",", " ", "roots"}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"rootsReals", " ", "=", " ", 
       RowBox[{"Solve", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"t", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"a", "*", "t"}], "+", "b"}], ")"}], "^", "2"}], "+", 
               RowBox[{
                RowBox[{"fPrime", "^", "2"}], 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"c", "*", "t"}], "+", "d"}], ")"}], "^", "2"}]}]}],
               ")"}], "^", "2"}]}], "-", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"a", "*", "d"}], "-", 
              RowBox[{"b", "*", "c"}]}], ")"}], "*", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"1", "+", 
               RowBox[{
                RowBox[{"f", "^", "2"}], "*", 
                RowBox[{"t", "^", "2"}]}]}], ")"}], "^", "2"}], "*", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"a", "*", "t"}], "+", "b"}], ")"}], "*", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"c", "*", "t"}], "+", "d"}], ")"}]}]}], "\[Equal]", 
          "0"}], ",", "t", ",", "Reals"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"\"\<rootsReals = \>\"", ",", " ", "rootsReals"}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"tInfinity", "=", " ", 
       RowBox[{
        RowBox[{"1", "/", 
         RowBox[{"f", "^", "2"}]}], "+", 
        RowBox[{
         RowBox[{"c", "^", "2"}], "/", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"a", "^", "2"}], "+", 
           RowBox[{
            RowBox[{"fPrime", "^", "2"}], "*", 
            RowBox[{"c", "^", "2"}]}]}], ")"}]}]}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"\"\<t at Infinity = \>\"", ",", " ", "tInfinity"}], "]"}], 
      ";"}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellChangeTimes->CompressedData["
1:eJwdzlsoQ3EAx/GDmJiMUprERCQtTra0QpgMuRcrJoYR5ZpIeTBSbHk4ja3c
H1xiCCvbcl0ieVYjorVyTyQ1ZP6/8/Dr8/B7+QqUbaUNnhRFRZJB+69dJzh7
zghbdE7AGhd/HmZJppbgRMH+GrwUdVjgcbjjCI5lymww7lV8Dttjb+1Q7F3n
gJ/awHeYOVr/BYt3T76hlyLPN4rINOmDoH31SAKdtDkNmqdkWXD3w1gGo1tS
5bB3PEwBh9whtVD3YlLC/WSqESpVolYo7X7Yiib2dBZsw+ERnwNYJv1hPXno
c0B51+wn+1erXDBbne4TQ7zbeQqA9eXWYMgLZoQ5xMdNZyKk97KLoJj5K4Gh
A1y1jNhv5bFShUIqFz2DXF+oddOHcHr++hhai96K84gzWlUFXPZPqoJtvXpW
jmFRDf0MtAZKmA4d5M+drkCTS7QBLxLiTXDdOGmBgh4PG7w6uHmH1833rCkL
PE4+UdMZwWoLUqy1E7cqa9fhPyyICr4=
  "],ExpressionUUID->"3c71aada-aec7-45d0-bebb-7c2bd1f771a7"]
},
WindowSize->{681, 676},
WindowMargins->{{-7, Automatic}, {Automatic, 0}},
FrontEndVersion->"11.1 for Microsoft Windows (64-bit) (April 18, 2017)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 15725, 385, 2186, "Input", "ExpressionUUID" -> \
"3c71aada-aec7-45d0-bebb-7c2bd1f771a7"]
}
]
*)

(* End of internal cache information *)

